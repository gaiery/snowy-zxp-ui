(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{445:function(t,e,i){},465:function(t,e,i){"use strict";i(445)},479:function(t,e,i){"use strict";i.r(e);i(164);var o={name:"m-image-shot",model:{prop:"list"},props:{url:{type:String,required:!0},disabled:{type:Boolean,default:!1},list:{type:Array,default:function(){return[]}},scale:{type:Number,default:100},padding:{type:Number,default:1}},data(){return{pointList:[{index:1,position:["left","top"]},{index:2,position:[null,"top"]},{index:3,position:["right","top"]},{index:4,position:["right",null]},{index:5,position:["right","bottom"]},{index:6,position:[null,"bottom"]},{index:7,position:["left","bottom"]},{index:8,position:["left",null]}],lineList:["left","top","right","bottom"],trueWidth:0,trueHeight:0,currentWidth:0,currentHeight:0,tempCrop:{},changePosition:[],cropClientX:0,cropClientY:0,data_disable:this.disabled,imgUrlNew:"",target:{cropW:0,cropH:0},data_list:this.data_list}},mounted(){this.initImage(this.url)},methods:{clickGeneratePicture(){let t=this.$refs.previewImg;t.width=500,t.height=450;let e=this.$refs.sourceImg,i=t.getContext("2d"),o=(500-this.target.cropW/(this.scale/100))/2,r=(500-this.target.cropH/(this.scale/100))/2;i.drawImage(e,this.target.cropX/(this.scale/100),this.target.cropY/(this.scale/100),this.target.cropW/(this.scale/100),this.target.cropH/(this.scale/100),o,r,this.target.cropW/(this.scale/100),this.target.cropH/(this.scale/100))},getTargetImgUrl(){let t=this.$refs.previewImg.toDataURL("image/png").replace(this.imgType("png"),"image/octet-stream");this.$emit("targetImgUrl",t)},download(){let t=this.$refs.previewImg.toDataURL("image/png").replace(this.imgType("png"),"image/octet-stream");this.saveFile(t,"图片.png")},imgType:t=>"image/"+t.toLowerCase().replace(/jpg/i,"jpeg").match(/png|jpeg|bmp|gif/)[0],saveFile(t,e){let i=document.createElement("a");i.href=t,i.download=e;let o=document.createEvent("MouseEvents");o.initEvent("click",!0,!1),i.dispatchEvent(o)},initImage(t){let e=new Image;e.onload=()=>{this.currentWidth=e.width*this.scale/100,this.currentHeight=e.height*this.scale/100,this.trueWidth=e.width,this.trueHeight=e.height,this.$emit("img",{width:e.width,height:e.height})},e.src=t},startMove(t){if(!this.disabled){let e={id:this.guid(),cropW:0,cropH:0,cropX:t.offsetX,cropY:t.offsetY,oldCropW:0,oldCropH:0,oldCropX:t.offsetX,oldCropY:t.offsetY,canEdit:!0};this.tempCrop=e,this.data_list=[],this.data_list.push(e),this.cropClientX=t.clientX,this.cropClientY=t.clientY,window.addEventListener("mousemove",this.createCrop),window.addEventListener("mouseup",this.endCrop)}},createCrop(t){let e=t.clientX,i=t.clientY,o=this.tempCrop,r=e-this.cropClientX,p=i-this.cropClientY;r>=0?(o.cropW=Math.min(this.currentWidth-o.oldCropX-2*this.padding,r),o.cropX=o.oldCropX):(o.cropW=Math.min(o.oldCropX-2*this.padding,Math.abs(r)),o.cropX=Math.max(o.oldCropX+r,this.padding)),p>=0?(o.cropH=Math.min(this.currentHeight-o.oldCropY-2*this.padding,p),o.cropY=o.oldCropY):(o.cropH=Math.min(o.oldCropY-2*this.padding,Math.abs(p)),o.cropY=Math.max(o.oldCropY+p,this.padding)),o.cropW>10&&o.cropH>10&&(o.temp=!1),this.target=o,this.clickGeneratePicture()},endCrop(){window.removeEventListener("mousemove",this.createCrop),window.removeEventListener("mouseup",this.endCrop),this.tempCrop={},this.$emit("getTargetBox",this.target),this.getTargetImgUrl()},cropMove(t,e){!this.disabled&&e.canEdit&&(this.cropClientX=t.clientX,this.cropClientY=t.clientY,e.oldCropW=e.cropW,e.oldCropH=e.cropH,e.oldCropX=e.cropX,e.oldCropY=e.cropY,this.tempCrop=e,window.addEventListener("mousemove",this.moveCrop),window.addEventListener("mouseup",this.leaveCrop))},moveCrop(t){t.preventDefault();let e=t.clientX,i=t.clientY,o=this.tempCrop,r=e-this.cropClientX,p=i-this.cropClientY;o.cropX=Math.min(Math.max(o.oldCropX+r,this.padding),this.currentWidth-o.cropW-2*this.padding),o.cropY=Math.min(Math.max(o.oldCropY+p,this.padding),this.currentHeight-o.cropH-2*this.padding),this.target=o,this.clickGeneratePicture()},leaveCrop(){console.log("截图移动结束"),window.removeEventListener("mousemove",this.moveCrop),window.removeEventListener("mouseup",this.leaveCrop),this.$emit("getTargetBox",this.target),this.getTargetImgUrl()},deleteCrop(t){console.log("删除框选"),this.disabled||this.data_list.splice(t,1)},changeCropSize(t,e,i){!this.disabled&&e.canEdit&&(window.addEventListener("mousemove",this.changeCropNow),window.addEventListener("mouseup",this.changeCropEnd),this.cropClientX=t.clientX,this.cropClientY=t.clientY,e.oldCropW=e.cropW,e.oldCropH=e.cropH,e.oldCropX=e.cropX,e.oldCropY=e.cropY,this.changePosition=i,this.tempCrop=e,this.target=e,this.clickGeneratePicture())},changeCropNow(t){t.preventDefault();let e=t.clientX,i=t.clientY,o=this.tempCrop,r=this.changePosition,p=e-this.cropClientX,n=i-this.cropClientY;r.indexOf("left")>-1?o.oldCropW-p>=0?(o.cropW=Math.min(o.oldCropW-p,o.oldCropX+o.oldCropW),o.cropX=Math.max(this.padding,o.oldCropX+p)):(o.cropW=Math.min(p-o.oldCropW,this.currentWidth-o.oldCropX-o.oldCropW-2*this.padding),o.cropX=o.oldCropX+o.oldCropW):r.indexOf("right")>-1&&(o.oldCropW+p>=0?(o.cropW=Math.min(this.currentWidth-o.cropX-2*this.padding,o.oldCropW+p),o.cropX=o.oldCropX):(o.cropW=Math.min(Math.abs(p+o.oldCropW),o.oldCropX-2*this.padding),o.cropX=Math.max(this.padding,o.oldCropX-o.cropW))),r.indexOf("top")>-1?o.oldCropH-n>0?(o.cropH=Math.min(o.oldCropH-n,o.oldCropH+o.oldCropY-2*this.padding),o.cropY=Math.max(this.padding,o.oldCropY+n)):(o.cropH=Math.min(n-o.oldCropH,this.currentHeight-o.oldCropY-o.oldCropH),o.cropY=o.oldCropY+o.oldCropH):r.indexOf("bottom")>-1&&(o.oldCropH+n>0?(o.cropH=Math.min(this.currentHeight-o.cropY-2*this.padding,o.oldCropH+n),o.cropY=o.oldCropY):(o.cropH=Math.min(Math.abs(n+o.oldCropH),o.oldCropY-2*this.padding),o.cropY=Math.max(this.padding,o.oldCropY+o.oldCropH+n))),this.target=o,this.clickGeneratePicture()},changeCropEnd(){window.removeEventListener("mousemove",this.changeCropNow),window.removeEventListener("mouseup",this.changeCropEnd),this.clickGeneratePicture(),this.$emit("getTargetBox",this.target),this.getTargetImgUrl()},guid:()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){let e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})),changeCropScale(t,e){let i=t/e;this.data_list.forEach(t=>{t.cropX=t.cropX*i,t.cropY=t.cropY*i,t.cropW=t.cropW*i,t.cropH=t.cropH*i})}},watch:{scale(t,e){this.url&&(this.currentWidth=this.trueWidth*t/100,this.currentHeight=this.trueHeight*t/100,this.changeCropScale(t,e))}}},r=(i(465),i(40)),p=Object(r.a)(o,(function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"cropper-container",style:{width:t.currentWidth+"px",height:t.currentHeight+"px"},on:{mousedown:function(e){return e.preventDefault(),t.startMove.apply(null,arguments)}}},[e("div",{staticClass:"cropper-mask",class:{"bg-opcity":t.list.length>0}}),t._v(" "),e("img",{ref:"sourceImg",style:{width:t.currentWidth+"px",height:t.currentHeight+"px"},attrs:{src:t.url,alt:"背景图片"}}),t._v(" "),t._l(t.data_list,(function(i,o){return e("div",{key:i.id,ref:"imageDom",refInFor:!0,staticClass:"crop-box",style:{width:i.cropW+"px",height:i.cropH+"px",transform:"translate3d("+i.cropX+"px,"+i.cropY+"px,0)"}},[e("span",{staticClass:"cropper-face",on:{mousedown:function(e){return e.stopPropagation(),t.cropMove(e,i)},contextmenu:function(e){return e.preventDefault(),t.deleteCrop(o)}}}),t._v(" "),e("span",{directives:[{name:"show",rawName:"v-show",value:i.canEdit,expression:"item.canEdit"}]},[t._l(t.lineList,(function(o){return e("span",{key:o,class:["line-"+o,"crop-line"],on:{mousedown:function(e){return e.stopPropagation(),t.changeCropSize(e,i,o)}}})})),t._v(" "),t._l(t.pointList,(function(o){return e("span",{key:o.index,class:["point"+o.index,"crop-point"],on:{mousedown:function(e){return e.stopPropagation(),t.changeCropSize(e,i,o.position)}}})}))],2)])}))],2),t._v(" "),e("div",{staticStyle:{position:"relative"}},[e("canvas",{ref:"previewImg",attrs:{id:"previewImg"}}),t._v(" "),e("button",{staticClass:"download",staticStyle:{position:"absolute"},on:{click:t.download}},[t._v("下载")])])])}),[],!1,null,"7f6dbb70",null);e.default=p.exports}}]);